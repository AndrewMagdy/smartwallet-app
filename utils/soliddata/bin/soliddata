#!/usr/bin/env python2

import argparse
import json
from soliddata.validators import validate_blueprint
from soliddata.writers import SolidDataWriter

if __name__ == '__main__':
    parser = argparse.ArgumentParser(
        description='Generate test data for little-sister app')

    parser.add_argument('--blueprint', dest='blueprint', required=True)
    parser.add_argument('--output-dir', dest='output_dir', required=True)
    parser.add_argument('--flatten', action='store_true',
                        dest='flatten')

    args = parser.parse_args()

    with open(args.blueprint) as blueprint_file:
        blueprint_json = json.load(blueprint_file)

        print('Validating blueprint...')
        validate_blueprint(blueprint_json)
        print('Done.')
        print('Outputing containers to {} ...'.format(args.output_dir))
        writer = SolidDataWriter(blueprint_json, args.output_dir, args.flatten)
        writer.write_containers()
        print('Done.')
